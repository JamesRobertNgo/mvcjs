<!doctype html>

<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">

	<title></title>

	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="style.css">
</head>

<body>
	<p>Hello world! This is HTML5 Boilerplate.</p>

	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<script src="mvcjs.eventful.js"></script>
	<script>
		const app = {};

		app.model = ['load test', 'another load test'];

		app.View = class extends mvcjs.Eventful {
			render(wrapper) {
				const $el = this.$el = $('<div></div>');

				const $list = this.$list = $('<ol></ol>');
				$el.append($list);

				const $entry = $('<p><input type="text"> <button type="button">Add</button></p>');
				const $entryInput = $entry.find('input');
				$entry.find('button').on('click', (e) => {
					e.preventDefault();
					this.insert($entryInput.val() || undefined);
					$entryInput.val('');
				});
				$el.append($entry);

				if (wrapper) {
					$(wrapper).append($el);
				}
				this.trigger('render', $el);
				return $el;
			}

			insert(label = 'Untitled') {
				const $listItem = $(`<li>${label} <button type="button">Remove</button></li>`);
				$listItem.find('button').on('click', (e) => {
					const idx = this.$list.children('li').index($listItem);
					this.remove(idx);
				})
				this.$list.append($listItem);
				this.trigger('insert', label);
			}

			remove(idx) {
				const $listItem = this.$list.children(`li:nth-child(${idx + 1})`);
				$listItem.detach();
				this.trigger('remove', idx);
			}
		};

		app.controller = function() {
			const model = app.model;
			const view = new app.View();
			view.on('render', ($el) => {
				for (const label of model) {
					view.insert(label);
				}
				view.on('insert', (label) => model.push(label));
				view.on('remove', (idx) => model.splice(idx, 1));
			});
			view.render($(document.body));
		};

		$(function() {
			app.controller();
		});
	</script>
</body>

</html>
